<!DOCTYPE html>
<html 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/defaultLayout}">
      
      
<section layout:fragment="content" class="contents d-flex justify-content-center">
	<div class="login-box mt-5">
		<h1>로그인</h1>
		
		<!-- 키보드로 enter을 누르면 form이 동작되어 로그인이 되도록 한다.  -->
		<form method="post" action="/user/sign-in" id="loginForm">
			<div class="form-group">
				<input type="text" name="loginId" placeholder="아이디를 입력하세요" class="form-control mt-4">
				<input type="password" name="password" placeholder="암호를 입력하세요" class="form-control mt-1">
			</div>
			<div>
				<input type="submit" id="loginBtn" value="로그인" class="btn btn-warning w-100">
			</div>
			<div>
				<a class="btn btn-primary w-100 mt-2" href="/user/sign-up-view">회원가입</a> 
			</div>
		</form>
	
	</div>
</section>

<th:block layout:fragment="script">
    <script>
		$(document).ready(function() {
			
			// 로그인
			$("form").on('submit',function(e) {
				e.preventDefault(); // 서브밋(form) 기능 중단 => 화면 이동 기능 중단
				
				// validation
				let loginId = $("input[name=loginId]").val().trim();
				let password = $("input[name=password]").val();
				
				if(!loginId) {
					alert("아이디를 입력하세요");
					return false;
				}
				
				if(!password) {
					alert("비밀번호를 입력하세요");
					return false;
				}
				
				
				let url = $(this).attr('action'); 
				console.log(url);
				let params = $(this).serialize(); //name 속성 반드시 있어야 가지고 올 수 있다.
				console.log(params); 
				
				// ajax
				$.post(url, params) //request
				.done(function(data){ //response 
					if(data.result == "성공"){
						// 로그인 성공이면 글목록 화면으로 이동 
						location.href="/post/post-list-view"; 
					} else {
						alert(data.error_message);
					}
				}); 
				
			});						
		});
    </script>
</th:block>